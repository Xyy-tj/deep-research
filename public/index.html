<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Research Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                    },
                    typography: {
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                                color: '#333',
                                a: {
                                    color: '#0ea5e9',
                                    '&:hover': {
                                        color: '#0369a1',
                                    },
                                },
                            },
                        },
                    },
                },
            },
        }
    </script>
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .transition-height {
            transition: max-height 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8">
        <div class="absolute top-4 right-4 flex items-center space-x-4">
            <div id="userSection" class="hidden">
                <span id="userGreeting" class="text-gray-700 mr-2"></span>
                <button id="logoutBtn" class="px-4 py-2 text-sm rounded-lg bg-gray-200 hover:bg-gray-300 transition-colors">
                    <i class="fas fa-sign-out-alt mr-1"></i> Logout
                </button>
            </div>
            <div id="authSection">
                <button id="loginBtn" class="px-4 py-2 text-sm rounded-lg bg-primary-600 text-white hover:bg-primary-700 transition-colors">
                    <i class="fas fa-sign-in-alt mr-1"></i> Login
                </button>
                <button id="registerBtn" class="px-4 py-2 text-sm rounded-lg bg-gray-200 hover:bg-gray-300 transition-colors ml-2">
                    <i class="fas fa-user-plus mr-1"></i> Register
                </button>
            </div>
        </div>

        <div id="authModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
            <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="authModalTitle" class="text-2xl font-bold text-gray-800">Login</h2>
                    <button id="closeAuthModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="authForm" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" name="username" required
                               class="w-full px-4 py-2 rounded-lg border-2 border-gray-200 focus:border-primary-500 focus:ring focus:ring-primary-200">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" name="password" required
                               class="w-full px-4 py-2 rounded-lg border-2 border-gray-200 focus:border-primary-500 focus:ring focus:ring-primary-200">
                    </div>
                    <button type="submit" id="authSubmitBtn"
                            class="w-full py-2 px-4 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                        Login
                    </button>
                    <p id="authError" class="text-red-600 text-sm hidden"></p>
                </form>
            </div>
        </div>

        <div id="mainContent" class="hidden">
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-gray-800 mb-4">Deep Research Assistant</h1>
                <p class="text-lg text-gray-600">Discover deeper insights with AI-powered research</p>
            </div>
            
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-xl p-8 mb-8 transform transition-all hover:shadow-2xl">
                    <form id="researchForm" method="post" onsubmit="return false;" class="space-y-8">
                        <div class="relative">
                            <label for="query" class="block text-sm font-medium text-gray-700 mb-2">Research Topic</label>
                            <div class="relative rounded-lg shadow-sm">
                                <input type="text" id="query" name="query" 
                                       class="block w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-primary-500 focus:ring focus:ring-primary-200 focus:ring-opacity-50 transition-colors"
                                       placeholder="Enter your research topic...">
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label for="breadth" class="block text-sm font-medium text-gray-700">
                                    Research Breadth <span class="text-primary-600 font-semibold" id="breadthValue">4</span>
                                </label>
                                <div class="flex items-center space-x-4">
                                    <i class="fas fa-compress-alt text-gray-400"></i>
                                    <input type="range" id="breadth" name="breadth" min="2" max="10" value="4" 
                                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-500">
                                    <i class="fas fa-expand-alt text-gray-400"></i>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label for="depth" class="block text-sm font-medium text-gray-700">
                                    Research Depth <span class="text-primary-600 font-semibold" id="depthValue">2</span>
                                </label>
                                <div class="flex items-center space-x-4">
                                    <i class="fas fa-layer-group text-gray-400"></i>
                                    <input type="range" id="depth" name="depth" min="1" max="5" value="2" 
                                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-500">
                                    <i class="fas fa-layer-group text-gray-400 transform scale-125"></i>
                                </div>
                            </div>
                        </div>

                        <button type="button" id="startResearch" 
                                class="w-full flex items-center justify-center py-3 px-6 rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transform transition-all hover:scale-[1.02] active:scale-[0.98]">
                            <i class="fas fa-brain mr-2"></i>
                            Start Research
                        </button>
                    </form>
                </div>

                <div id="interactiveDialog" class="hidden">
                    <div class="bg-primary-50 border-l-4 border-primary-400 rounded-lg p-6 animate-pulse-slow">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <i class="fas fa-robot text-2xl text-primary-400"></i>
                            </div>
                            <div class="ml-4 flex-1">
                                <p id="questionText" class="text-lg font-medium text-primary-900 mb-4"></p>
                                <div class="space-y-3">
                                    <input type="text" id="answerInput" 
                                           class="w-full px-4 py-2 rounded-lg border-2 border-primary-200 focus:border-primary-500 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
                                           placeholder="Type your answer here...">
                                    <button id="submitAnswer" 
                                            class="inline-flex items-center px-6 py-2 rounded-lg text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
                                        <i class="fas fa-paper-plane mr-2"></i>
                                        Submit Answer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="progress" class="hidden mt-8">
                    <div class="relative pt-1">
                        <div class="flex mb-3 items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-spinner fa-spin text-primary-600 mr-2"></i>
                                <span class="text-sm font-semibold text-primary-600">
                                    Researching...
                                </span>
                            </div>
                            <div>
                                <span id="progressText" class="text-sm font-semibold text-primary-600">0%</span>
                            </div>
                        </div>
                        <div class="overflow-hidden h-3 rounded-full bg-primary-100">
                            <div id="progressBar" 
                                 class="h-full rounded-full bg-primary-600 transition-all duration-500 ease-out"
                                 style="width: 0%">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="results" class="mt-8 space-y-6">
                    <!-- Results will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-12 py-6 text-center text-gray-600">
        <p>Powered by Deep Research AI</p>
    </footer>

    <script type="module">
        import { Auth } from '/auth.js';

        const auth = Auth.getInstance();
        const userSection = document.getElementById('userSection');
        const authSection = document.getElementById('authSection');
        const userGreeting = document.getElementById('userGreeting');
        const authModal = document.getElementById('authModal');
        const authModalTitle = document.getElementById('authModalTitle');
        const authForm = document.getElementById('authForm');
        const authSubmitBtn = document.getElementById('authSubmitBtn');
        const authError = document.getElementById('authError');
        const mainContent = document.getElementById('mainContent');

        // Check initial auth state
        if (auth.checkAuth()) {
            showUserSection();
            showMainContent();
        } else {
            hideMainContent();
        }

        // Event Listeners
        document.getElementById('loginBtn').addEventListener('click', () => showAuthModal('login'));
        document.getElementById('registerBtn').addEventListener('click', () => showAuthModal('register'));
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        document.getElementById('closeAuthModal').addEventListener('click', hideAuthModal);
        authForm.addEventListener('submit', handleAuth);

        function showAuthModal(type) {
            authModalTitle.textContent = type === 'login' ? 'Login' : 'Register';
            authSubmitBtn.textContent = type === 'login' ? 'Login' : 'Register';
            authForm.dataset.type = type;
            authModal.classList.remove('hidden');
            authError.classList.add('hidden');
        }

        function hideAuthModal() {
            authModal.classList.add('hidden');
            authForm.reset();
        }

        async function handleAuth(e) {
            e.preventDefault();
            const type = authForm.dataset.type;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const success = type === 'login' 
                    ? await auth.login(username, password)
                    : await auth.register(username, password);

                if (success) {
                    hideAuthModal();
                    showUserSection();
                    showMainContent();
                } else {
                    showError(type === 'login' ? 'Invalid credentials' : 'Registration failed');
                }
            } catch (error) {
                showError('An error occurred. Please try again.');
            }
        }

        function handleLogout() {
            auth.logout();
            hideUserSection();
            hideMainContent();
        }

        function showUserSection() {
            userSection.classList.remove('hidden');
            authSection.classList.add('hidden');
            userGreeting.textContent = `Welcome, ${auth.getCurrentUser()}!`;
        }

        function hideUserSection() {
            userSection.classList.add('hidden');
            authSection.classList.remove('hidden');
            userGreeting.textContent = '';
        }

        function showMainContent() {
            mainContent.classList.remove('hidden');
        }

        function hideMainContent() {
            mainContent.classList.add('hidden');
        }

        function showError(message) {
            authError.textContent = message;
            authError.classList.remove('hidden');
        }
    </script>
    <script src="/main.js" type="module"></script>
</body>
</html>
